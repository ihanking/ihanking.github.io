---
title: 学员考试成绩嵌套查询
date: 2020-11-16
draft: false
tags: ["sql"]
categories: ["数据库系列"]
---

`stu_info`表结构如下
```sql
+-------------+-------------+------+-----+---------+----------------+
| Field       | Type        | Null | Key | Default | Extra          |
+-------------+-------------+------+-----+---------+----------------+
| id          | int(11)     | NO   | PRI | NULL    | auto_increment |
| name        | varchar(20) | YES  |     | NULL    |                |
| gender      | char(1)     | YES  |     | NULL    |                |
| department  | varchar(10) | YES  |     | NULL    |                |
| age         | tinyint(4)  | YES  |     | NULL    |                |
| province    | varchar(10) | YES  |     | NULL    |                |
| email       | varchar(50) | YES  |     | NULL    |                |
| mobilephone | char(11)    | YES  |     | NULL    |                |
+-------------+-------------+------+-----+---------+----------------+
```

`stu_score`表结构如下
```sql
+---------------+------------+------+-----+---------+-------+
| Field         | Type       | Null | Key | Default | Extra |
+---------------+------------+------+-----+---------+-------+
| id            | int(11)    | YES  |     | NULL    |       |
| MySQL         | tinyint(4) | YES  |     | NULL    |       |
| Python        | tinyint(4) | YES  |     | NULL    |       |
| Visualization | tinyint(4) | YES  |     | NULL    |       |
+---------------+------------+------+-----+---------+-------+
```

**查询与张勇、刘伟同一个系的学员信息**
```sql
SELECT
    *
FROM
    stu_info
WHERE
    department
IN
    (SELECT department FROM stu_info WHERE name IN('张勇','刘伟'));
```

**查询MySQL成绩大于90分的学员信息**

方式一：
```sql
select
    *
from
    stu_info
where
    id
in
    (select
        id
    from
        stu_score
    where
        MySQL>90
    );
```

方式二：
```sql
select
    *
from
    stu_info
where EXISTS
    (select
        1
    from
        stu_score
    where
        stu_score.id=stu_info.id
    and
        MySQL>90
    );
```

**查询年龄超过所属系科平均年龄的学员信息**
```sql
SELECT
    *
FROM
    stu_info
AS
    t1
WHERE
    age >= (SELECT
        AVG(age) FROM stu_info AS t2 WHERE t1.department = t2.department);
```

**查询非管理系中比管理系任意一个学员年龄小的学员信息**
```sql
SELECT * FROM stu_info
WHERE age <ANY (
SELECT DISTINCT age FROM stu_info 
WHERE department = '管理系')
AND department != '管理系';
```

**查询非管理系中比管理系所有学员年龄小的学员信息**
```sql
SELECT * FROM stu_info
WHERE age <ALL (
SELECT DISTINCT age FROM stu_info 
WHERE department = '管理系')
AND department != '管理系';
```

**ON关键词后面跟不等式**
```sql
select t1.*,t2.Python,t2.Visualization
from stu_info as t1
left join stu_score as t2
on t1.id=t2.id and MySQL > 90;
```

```sql
select t1.*,t2.Python,t2.Visualization
from stu_info as t1
left join stu_score as t2
on t1.id=t2.id 
where MySQL > 90;
```