---
title: 嵌套查询
date: 2020-11-11
draft: false
tags: ["sql"]
categories: ["数据库系列"]
---

有两张表`stu_info`和`stu_score`

`stu_info`表结构:
```
+-------------+-------------+------+-----+---------+----------------+
| Field       | Type        | Null | Key | Default | Extra          |
+-------------+-------------+------+-----+---------+----------------+
| id          | int(11)     | NO   | PRI | NULL    | auto_increment |
| name        | varchar(20) | YES  |     | NULL    |                |
| gender      | char(1)     | YES  |     | NULL    |                |
| department  | varchar(10) | YES  |     | NULL    |                |
| age         | tinyint(4)  | YES  |     | NULL    |                |
| province    | varchar(10) | YES  |     | NULL    |                |
| email       | varchar(50) | YES  |     | NULL    |                |
| mobilephone | char(11)    | YES  |     | NULL    |                |
+-------------+-------------+------+-----+---------+----------------+
```

`stu_score`表结构:
```
+---------------+------------+------+-----+---------+-------+
| Field         | Type       | Null | Key | Default | Extra |
+---------------+------------+------+-----+---------+-------+
| id            | int(11)    | YES  |     | NULL    |       |
| MySQL         | tinyint(4) | YES  |     | NULL    |       |
| Python        | tinyint(4) | YES  |     | NULL    |       |
| Visualization | tinyint(4) | YES  |     | NULL    |       |
+---------------+------------+------+-----+---------+-------+
```


### IN关键词

**查询与张勇、刘伟同一个系的学员信息**
```sql
SELECT *
FROM stu_info
WHERE department IN (SELECT department FROM stu_info WHERE name IN('张勇','刘伟'));
```

**查询MySQL成绩大于90分的学员信息**
```sql
select *
from stu_info
where id in (
select id 
from stu_score
where MySQL>90
);
```

### EXISTS关键词

**查询MySQL成绩大于90分的学员信息**

```sql
select *
from stu_info
where EXISTS(
select 1
from stu_score
where stu_score.id=stu_info.id
and MySQL>90
);
```

### 比较运算符

**查询年龄超过所属系科平均年龄的学员信息**
```sql
SELECT * FROM stu_info AS t1
WHERE  age >= (SELECT AVG(age) FROM stu_info AS t2 WHERE t1.department = t2.department);
```

### ANY或ALL关键词

**查询非管理系中比管理系任意一个学员年龄小的学员信息**
```sql
SELECT * FROM stu_info
WHERE age <ANY (
SELECT DISTINCT age FROM stu_info 
WHERE department = '管理系')
AND department != '管理系';
```

**查询非管理系中比管理系所有学员年龄小的学员信息**
```sql
SELECT * FROM stu_info
WHERE age <ALL (
SELECT DISTINCT age FROM stu_info 
WHERE department = '管理系')
AND department != '管理系';
```






