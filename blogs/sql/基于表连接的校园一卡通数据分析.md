---
title: 基于表连接的校园一卡通数据分析
date: 2020-11-16
draft: false
tags: ["sql"]
categories: ["数据库系列"]
---

::: tip
此项目对学生的校园一卡通刷卡记录信息进行简单分析
:::

**ON关键词后面跟不等式**
```sql
select
    t1.*,
    t2.Python,
    t2.Visualization
from stu_info as t1
left join stu_score as t2
on t1.id=t2.id and MySQL > 90;
```

**将不等式条件放在WHERE关键词后面**
```sql
select
    t1.*,
    t2.Python,
    t2.Visualization
from stu_info as t1
left join stu_score as t2
on t1.id=t2.id 
where MySQL > 90;
```


**查询某位学生借书记录**

```sql
select distinct *
from stu_borrow
where stu_id="9708"
order by borrow_date;
```

**查询某位学生消费记录**

```sql
select *
from stu_card
where stu_id="1040"
order by custom_date
```

**基于stu_borrow表统计并将统计结果存储到borrow_time表**
```sql
create table
	borrow_times as
select
	stu_id,
	count(distinct borrow_date) as borrow_times,
	count(distinct book_title) as books
from stu_borrow
where borrow_date between "2014-09-01" and "2015-08-31"
group by stu_id
```

**删除重复记录以及消费金额为负的记录，并将清洗结果存储到stu_card_distinct表**
```sql
create table stu_card_distinct as
select distinct *
from stu_card
where amt>0
```

**基于stu_card_distinct表统计并将结果存储到custom表**
```sql
create table custom as
select
	stu_id,
	count(*) as custom_times,
	sum(amt) as custom_amt,
	min(amt) as min_amt,
	max(amt) as max_amt,
	sum(amt)/count(*) as pct
from stu_card_distinct
where custom_date between "2014-09-01" and "2015-08-31"
group by stu_id
```